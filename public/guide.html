<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guide — BigRed Workshop</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Guide interface for BigRed Workshop service management">
  <meta name="theme-color" content="#dc2626">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="BigRed Guide">
  <meta name="mobile-web-app-capable" content="yes">
  
  <!-- PWA Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="manifest" href="/manifest.webmanifest">
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="./admin.css">
  
  <!-- Отключаем кэширование для JS файлов -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
</head>
<body class="bg-gray-50 text-gray-900">
    <div id="guide-app">
        <!-- Header -->
        <div class="admin-header">
            <div class="container mx-auto px-4 flex items-center justify-between">
                <div class="flex items-center gap-4 flex-1">
                    <h1 class="flex items-center gap-3">
                        <i data-lucide="user" class="w-8 h-8 text-red-500"></i>
                        <span>Guide</span>
                    </h1>
                    <div class="flex items-center gap-2">
                        <span class="text-sm text-gray-500">Logged in as: </span>
                        <span id="userNameBadge" class="badge badge-info">—</span>
                    </div>
                </div>
                <div class="flex-shrink-0">
                    <button id="logoutBtn" type="button" class="btn btn-danger">
                        <i data-lucide="log-out" class="w-4 h-4"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-6">
            <!-- Log hours Card -->
            <div class="card mb-6">
                <div class="card-title">
                    <i data-lucide="clock" class="w-6 h-6"></i>
                    Log Hours
                </div>
                <div class="space-y-4">
                    <div class="form-group">
                        <label for="hoursBuggy" class="form-label">Buggy</label>
                        <select id="hoursBuggy" class="form-select"></select>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="form-group">
                            <label for="hoursVal" class="form-label">Hours (odo now)</label>
                            <input id="hoursVal" type="number" class="form-input" placeholder="e.g. 128" />
                        </div>
                        <div class="form-group">
                            <label for="hoursDate" class="form-label">Date</label>
                            <input id="hoursDate" type="date" class="form-input" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="hoursTime" class="form-label">Time of tour</label>
                        <select id="hoursTime" class="form-select"></select>
                    </div>

                    <button id="saveHours" class="btn btn-primary w-full">
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Save hours
                    </button>
                    <div id="recentHours" class="text-sm text-gray-600"></div>
                </div>
            </div>

            <!-- Quick Job Card -->
            <div class="card mb-6">
                <div class="card-title">
                    <i data-lucide="clipboard-list" class="w-6 h-6"></i>
                    Quick Job Card
                </div>

                <div class="space-y-4 md:space-y-0 md:grid md:grid-cols-2 md:gap-4">
                    <!-- Buggy -->
                    <div class="form-group">
                        <label for="jc-buggy" class="form-label">Buggy</label>
                        <select id="jc-buggy" class="form-select">
                            <option value="">Select buggy…</option>
                        </select>
                    </div>

                    <!-- Date -->
                    <div class="form-group">
                        <label for="jc-date" class="form-label">Date</label>
                        <input id="jc-date" type="date" class="form-input" />
                    </div>

                    <!-- Time (step 30 min) -->
                    <div class="form-group">
                        <label for="jc-time" class="form-label">Time of tour</label>
                        <select id="jc-time" class="form-select"></select>
                    </div>

                    <!-- Location -->
                    <div class="form-group">
                        <label for="jc-location" class="form-label">Location</label>
                        <select id="jc-location" class="form-select">
                            <option value="">Select location…</option>
                            <option value="Desert">Desert</option>
                            <option value="Base">Base</option>
                        </select>
                    </div>

                    <!-- Work done -->
                    <div class="form-group md:col-span-2">
                        <label for="jc-issue" class="form-label">
                            Work done <span class="text-gray-400 text-xs">(optional)</span>
                        </label>
                        <input id="jc-issue" type="text"
                               placeholder="e.g. Belt change, oil topped up"
                               class="form-input"
                               autocomplete="off">
                    </div>

                    <!-- Odometer hours -->
                    <div class="form-group">
                        <label for="jc-hours" class="form-label">Hours (odo)</label>
                        <input id="jc-hours" type="number" min="0" step="1" placeholder="e.g. 128" 
                               class="form-input"
                               inputmode="numeric" pattern="[0-9]*"/>
                    </div>

                    <!-- KM -->
                    <div class="form-group">
                        <label for="jc-km" class="form-label">KM</label>
                        <input id="jc-km" type="number" min="0" step="1" placeholder="e.g. 3500" 
                               class="form-input"
                               inputmode="numeric" pattern="[0-9]*"/>
                    </div>
                </div>

                <div class="mt-6 md:mt-8 space-y-3">
                    <button id="jc-save" class="btn btn-primary w-full" disabled>
                        <i data-lucide="save" class="w-4 h-4"></i>
                        Save job card
                    </button>
                    <span id="jc-hint" class="block text-center text-sm text-gray-500 hidden">UI-only: will just log payload to console</span>
                </div>
            </div>

            <!-- Create ticket Card -->
            <div class="card mb-6">
                <div class="card-title">
                    <i data-lucide="plus-circle" class="w-6 h-6"></i>
                    Create Ticket
                </div>
                <div class="space-y-4">
                    <div class="form-group">
                        <label for="ctBuggy" class="form-label">Buggy</label>
                        <select id="ctBuggy" class="form-select"></select>
                    </div>
                    <div class="form-group">
                        <label for="ctPriority" class="form-label">Priority</label>
                        <select id="ctPriority" class="form-select">
                            <option value="low">low</option>
                            <option value="medium" selected>medium</option>
                            <option value="high">high</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ctDesc" class="form-label">Description</label>
                        <textarea id="ctDesc" class="form-input" rows="2" placeholder="Describe the issue"></textarea>
                    </div>
                    <button id="createTicket" class="btn btn-primary w-full">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Create
                    </button>
                </div>
            </div>

            <!-- My open tickets Card -->
            <div class="card">
                <div class="card-title">
                    <i data-lucide="ticket" class="w-6 h-6"></i>
                    My Open Tickets
                </div>
                <div id="myTickets" class="space-y-3 text-sm"></div>
            </div>
        </div>
    </div>

    <!-- Supabase client with persistent session -->
    <script type="module" src="/supabase.js"></script>
    <script type="module" src="./api.js"></script>
    <script type="module" src="./guide.js"></script>
    
    <!-- PWA Scripts -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(r => console.log('[PWA] SW registered', r.scope))
                .catch(err => console.error('[PWA] SW register error', err));
        }
    </script>
    <script src="/pwa-install.js"></script>
    
    <!-- Initialize Lucide icons -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });
    </script>
</body>
</html>
