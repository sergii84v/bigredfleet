<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin • BigRed Fleet App</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#ef4444" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="BigRed Fleet App" />
  <link rel="apple-touch-icon" href="./icons/icon-192.png" />
  <link rel="manifest" href="./manifest.webmanifest" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link rel="stylesheet" href="./admin.css" />
</head>
<body>
  <div id="toasts" class="toast-container" aria-live="assertive" aria-atomic="true"></div>
  
  <div id="admin-app">
    <!-- Header -->
    <div class="admin-header">
      <div class="container mx-auto px-4 flex items-center justify-between">
        <div class="flex items-center gap-4 flex-1">
          <h1 class="flex items-center gap-3">
            <i data-lucide="shield" class="w-8 h-8 text-red-500"></i>
            <span>Admin</span>
          </h1>
          <div class="flex items-center gap-2">
            <span class="text-sm text-gray-500">Logged in as: </span>
            <span id="userNameBadge" class="badge badge-info">—</span>
          </div>
        </div>
        <div class="flex-shrink-0">
          <button id="logoutBtn" type="button" class="btn btn-danger">
            <i data-lucide="log-out" class="w-4 h-4"></i>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="container mx-auto px-4 pb-8">
      <div class="admin-stack">
        <!-- Tickets Section -->
        <section id="tickets-card" class="card">
          <div class="card-title">
            <i data-lucide="ticket" class="w-5 h-5"></i>
            Tickets
          </div>

          <div id="tickets-filters" class="filter-bar">
            <div class="filter-group">
              <label class="filter-label" for="tickets-status">Status</label>
              <select id="tickets-status" class="filter-select">
                <option value="">All statuses</option>
                <option value="open">Open</option>
                <option value="in_progress">In Progress</option>
                <option value="done">Done</option>
              </select>
            </div>

            <div class="filter-group">
              <label class="filter-label" for="tickets-buggy">Buggy</label>
              <select id="tickets-buggy" class="filter-select">
                <option value="">All buggies</option>
              </select>
            </div>

            <div class="filter-group">
              <label class="filter-label" for="tickets-priority">Priority</label>
              <select id="tickets-priority" class="filter-select">
                <option value="">All priorities</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
              </select>
            </div>

            <div class="filter-actions">
              <button id="tickets-reset" class="btn btn-secondary" type="button">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                Reset
              </button>
              <button id="admRefresh" class="btn btn-primary" type="button">
                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                Refresh
              </button>
            </div>
          </div>

          <!-- Pagination -->
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-2">
              <button id="admPrev" class="btn btn-secondary btn-sm">
                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                Prev
              </button>
              <button id="admNext" class="btn btn-secondary btn-sm">
                Next
                <i data-lucide="chevron-right" class="w-4 h-4"></i>
              </button>
            </div>
            <span id="admPage" class="text-sm text-gray-500">Page 1</span>
          </div>

          <!-- Cards on mobile, table on desktop -->
          <div id="admCards" class="block lg:hidden space-y-3"></div>
          
          <div class="hidden lg:block">
            <div class="table-container">
              <div class="table-scroll">
                <table id="admTickets" class="table">
                <thead>
                  <tr>
                    <th id="thCreated" class="cursor-pointer select-none">
                      <div class="flex items-center gap-2">
                        Created
                        <i data-lucide="chevron-up-down" class="w-4 h-4"></i>
                      </div>
                    </th>
                    <th>Buggy</th>
                    <th>Description</th>
                    <th>Status</th>
                    <th id="thPriority" class="cursor-pointer select-none">
                      <div class="flex items-center gap-2">
                        Priority
                        <i data-lucide="chevron-up-down" class="w-4 h-4"></i>
                      </div>
                    </th>
                    <th>Assignee</th>
                    <th>Started</th>
                    <th>Completed</th>
                    <th>Created by</th>
                    <th>Location</th>
                    <th>Hours</th>
                    <th>Km</th>
                    <th>Job done</th>
                    <th>Job status</th>
                    <th>Test drive</th>
                    <th>Parts</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              </div>
            </div>
          </div>
        </section>

        <!-- Buggy Hours Section -->
        <section id="hours-card" class="card">
          <div class="card-title">
            <i data-lucide="clock" class="w-5 h-5"></i>
            Buggy Hours
          </div>

          <form id="hours-filters" class="filter-bar" onsubmit="return false;">
            <div class="filter-group">
              <label class="filter-label" for="hours-buggy">Buggy</label>
              <select id="hours-buggy" class="filter-select">
                <option value="">All buggies</option>
              </select>
            </div>

            <div class="filter-group">
              <label class="filter-label" for="hours-from">From</label>
              <input id="hours-from" type="date" class="filter-input" />
            </div>

            <div class="filter-group">
              <label class="filter-label" for="hours-to">To</label>
              <input id="hours-to" type="date" class="filter-input" />
            </div>

            <div class="filter-actions">
              <button type="button" id="hours-apply" class="btn btn-primary">
                <i data-lucide="filter" class="w-4 h-4"></i>
                Apply
              </button>
              <button type="button" id="hours-reset" class="btn btn-secondary">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                Reset
              </button>
            </div>
          </form>

          <div id="hours-results" class="mt-6">
            <div class="table-container">
              <div class="table-scroll">
                <table id="hours-table" class="table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Time of tour</th>
                    <th>Guide</th>
                    <th>Hours</th>
                  </tr>
                </thead>
                <tbody id="hours-tbody"></tbody>
              </table>
              </div>
            </div>
          </div>


        </section>

        <!-- Guide Job Cards Section -->
        <section id="jobcards-card" class="card">
          <div class="card-title">
            <i data-lucide="clipboard-list" class="w-5 h-5"></i>
            Guide Job Cards
          </div>

          <div class="filter-bar" id="jobcards-filters">
            <div class="filter-group">
              <label class="filter-label">Buggy</label>
              <select id="jobcards-buggy" class="filter-select">
                <option value="">All buggies</option>
              </select>
            </div>
            
            <div class="filter-group">
              <label class="filter-label">From</label>
              <input id="jobcards-from" type="date" class="filter-input" />
            </div>
            
            <div class="filter-group">
              <label class="filter-label">To</label>
              <input id="jobcards-to" type="date" class="filter-input" />
            </div>
            
            <div class="filter-actions">
              <button id="jobcards-apply" class="btn btn-primary" type="button">
                <i data-lucide="filter" class="w-4 h-4"></i>
                Apply
              </button>
              <button id="jobcards-reset" class="btn btn-secondary" type="button">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                Reset
              </button>
            </div>
          </div>

          <!-- List Container -->
          <ul id="jobcards-list" class="space-y-3"></ul>

          <div class="flex items-center justify-between mt-6">
            <div class="flex items-center gap-3">
              <button id="jobcards-prev" class="btn btn-secondary btn-sm" type="button">
                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                Prev
              </button>
              <span id="jobcards-page" class="text-sm text-gray-500">Page 1</span>
              <button id="jobcards-next" class="btn btn-secondary btn-sm" type="button">
                Next
                <i data-lucide="chevron-right" class="w-4 h-4"></i>
              </button>
            </div>
          </div>
        </section>

        <!-- Buggies Section -->
        <section id="buggies-card" class="card">
          <div class="card-title flex items-center justify-between">
            <div class="flex items-center gap-3">
              <i data-lucide="car" class="w-5 h-5"></i>
              <span>Buggies</span>
            </div>
            <button id="btn-open-add-buggy" type="button" class="btn btn-primary">
              <i data-lucide="plus" class="w-4 h-4"></i>
              Add Buggy
            </button>
          </div>
          
          <div id="buggies-summary" class="buggies-summary"></div>
          <div id="buggies-list" class="buggies-list"></div>
          <div id="buggies-empty" class="empty-state hidden">No buggies yet. Use "Add Buggy".</div>
        </section>

        <!-- Dealer Visits Section -->
        <section id="dealer-visits-card" class="card">
          <div class="card-title flex items-center justify-between">
            <div class="flex items-center gap-3">
              <i data-lucide="building" class="w-5 h-5"></i>
              <span>Dealer Visits</span>
            </div>
            
            <div class="flex items-center gap-3">
              <div class="filter-group" style="min-width: auto;">
                <label class="filter-label" for="dealer-visits-filter">Show</label>
                <select id="dealer-visits-filter" class="filter-select">
                  <option value="active">Active</option>
                  <option value="returned">Returned</option>
                  <option value="all">All</option>
                </select>
              </div>
              
              <button id="dealer-visits-refresh" class="btn btn-secondary">
                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                Refresh
              </button>
            </div>
          </div>

          <div id="dealer-visits-list" class="space-y-3">
            <div class="text-center text-gray-400 py-8">
              <i data-lucide="loader-2" class="w-8 h-8 mx-auto mb-2 animate-spin"></i>
              <div>Loading…</div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Add Buggy Modal -->
  <div id="admin-add-buggy-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="addBuggyTitle">
    <div class="modal-card">
      <div class="modal-header">
        <h2 class="modal-title" id="addBuggyTitle">Add Buggy</h2>
        <button class="modal-close" id="btn-cancel-add-buggy" type="button">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>
      </div>
      
      <form id="addBuggyForm" autocomplete="off">
        <div class="space-y-4">
          <div class="form-group">
            <label class="form-label" for="buggy-number">Number</label>
            <input id="buggy-number" name="number" type="text" inputmode="numeric" autocomplete="off" required placeholder="e.g. 113" class="form-input" />
            <p id="buggy-number-error" class="field-error hidden">Number is required</p>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="buggy-model">Model (optional)</label>
            <input id="buggy-model" name="model" type="text" autocomplete="off" placeholder="e.g. Can-Am Maverick" class="form-input" />
          </div>
        </div>
        
        <div class="flex items-center justify-end gap-3 mt-6">
          <button id="btn-cancel-add-buggy-2" type="button" class="btn btn-secondary">Cancel</button>
          <button id="btn-create-buggy" type="button" class="btn btn-primary">
            <i data-lucide="plus" class="w-4 h-4"></i>
            Create
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => console.log('SW registered'))
          .catch(error => console.log('SW registration failed'));
      });
    }
  </script>

  <script type="module" src="./admin.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) {
        lucide.createIcons();
      }
    });
  </script>
</body>
</html>


